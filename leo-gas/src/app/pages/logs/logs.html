<div class="logs-page">
  <!-- HEADER -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <h1 class="page-title">Logs do Sistema</h1>
        <p class="page-subtitle">Registro de todas as ações realizadas</p>
      </div>
    </div>

    <!-- FILTROS -->
    <div class="filters-bar">
      <div class="filter-group">
        <label class="filter-label">Usuário</label>
        <select class="filter-select" [value]="filtroUsuario()" (change)="updateFiltroUsuario($event)">
          <option value="">Todos</option>
          @for (usuario of usuariosUnicos(); track usuario) {
            <option [value]="usuario">{{ usuario }}</option>
          }
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label">Ação</label>
        <select class="filter-select" [value]="filtroAcao()" (change)="updateFiltroAcao($event)">
          <option value="">Todas</option>
          <option value="criar">Criação</option>
          <option value="editar">Edição</option>
          <option value="excluir">Exclusão</option>
          <option value="pendencia">Pendência</option>
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label">Módulo</label>
        <select class="filter-select" [value]="filtroModulo()" (change)="updateFiltroModulo($event)">
          <option value="">Todos</option>
          <option value="Vendas">Vendas</option>
          <option value="Clientes">Clientes</option>
          <option value="Endereços">Endereços</option>
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label">Data início</label>
        <input type="date" class="filter-input" [value]="filtroDataInicio()" (change)="updateDataInicio($event)">
      </div>

      <div class="filter-group">
        <label class="filter-label">Data fim</label>
        <input type="date" class="filter-input" [value]="filtroDataFim()" (change)="updateDataFim($event)">
      </div>

      <div class="filter-group">
        <label class="filter-label">Ordenar</label>
        <div class="sort-options">
          <button [class.active]="sortOrder() === 'recentes'" (click)="setSortOrder('recentes')">Mais recentes</button>
          <button [class.active]="sortOrder() === 'antigos'" (click)="setSortOrder('antigos')">Mais antigos</button>
        </div>
      </div>

      @if (filtroUsuario() || filtroAcao() || filtroModulo() || filtroDataInicio() || filtroDataFim()) {
        <button class="btn-clear-filters" (click)="limparFiltros()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
          Limpar filtros
        </button>
      }
    </div>
  </div>

  <!-- CONTADOR -->
  <div class="logs-counter">
    <span>{{ logsFiltrados().length }} registro(s) encontrado(s)</span>
  </div>

  <!-- LISTA DE LOGS -->
  @if (logsPaginados().length > 0) {
    <div class="logs-list">
      @for (log of logsPaginados(); track log.id) {
        <div class="log-item" (click)="openModal(log)">
          <div class="log-acao-badge" [ngClass]="getAcaoClass(log.acao)">
            {{ getAcaoLabel(log.acao) }}
          </div>
          <div class="log-info">
            <p class="log-resumo">{{ log.resumo }}</p>
            <div class="log-meta">
              <span class="log-modulo">{{ log.modulo }}</span>
              <span class="log-separador">·</span>
              <span class="log-usuario">{{ log.usuario }}</span>
              <span class="log-separador">·</span>
              <span class="log-data">{{ formatarDataHora(log.data) }}</span>
            </div>
          </div>
          <div class="log-arrow">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="9 18 15 12 9 6"/>
            </svg>
          </div>
        </div>
      }
    </div>

    <!-- PAGINAÇÃO -->
    @if (totalPages() > 1) {
      <div class="pagination">
        <button class="pagination-btn" (click)="previousPage()" [disabled]="currentPage() === 1">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15 18 9 12 15 6"/>
          </svg>
        </button>

        @for (page of getPages(); track page) {
          <button class="pagination-btn" [class.active]="page === currentPage()" (click)="goToPage(page)">
            {{ page }}
          </button>
        }

        <button class="pagination-btn" (click)="nextPage()" [disabled]="currentPage() === totalPages()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9 18 15 12 9 6"/>
          </svg>
        </button>
      </div>
    }
  } @else {
    <div class="empty-state">
      <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
        <polyline points="14 2 14 8 20 8"/>
        <line x1="16" y1="13" x2="8" y2="13"/>
        <line x1="16" y1="17" x2="8" y2="17"/>
        <polyline points="10 9 9 9 8 9"/>
      </svg>
      <h3>Nenhum log encontrado</h3>
      <p>Ainda não há registros de ações ou os filtros não retornaram resultados.</p>
    </div>
  }
</div>

<!-- MODAL DE DETALHES -->
@if (selectedLog()) {
  <div class="modal-backdrop" (click)="closeModalBackdrop($event)">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Detalhes do Log</h2>
        <button class="btn-close" (click)="closeModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>

      <div class="modal-body-details">
        <div class="detail-row">
          <span class="detail-label">Ação</span>
          <span class="log-acao-badge" [ngClass]="getAcaoClass(selectedLog()!.acao)">
            {{ getAcaoLabel(selectedLog()!.acao) }}
          </span>
        </div>

        <div class="detail-row">
          <span class="detail-label">Módulo</span>
          <span class="detail-value">{{ selectedLog()!.modulo }}</span>
        </div>

        <div class="detail-row">
          <span class="detail-label">Usuário</span>
          <span class="detail-value">{{ selectedLog()!.usuario }}</span>
        </div>

        <div class="detail-row">
          <span class="detail-label">Data/Hora</span>
          <span class="detail-value">{{ formatarDataHora(selectedLog()!.data) }}</span>
        </div>

        <div class="detail-row">
          <span class="detail-label">Resumo</span>
          <span class="detail-value">{{ selectedLog()!.resumo }}</span>
        </div>

        @if (selectedLog()!.acao === 'editar' && selectedLog()!.detalhesAntes) {
          <div class="detail-section">
            <span class="detail-label">Antes</span>
            <pre class="detail-pre detail-antes">{{ selectedLog()!.detalhesAntes }}</pre>
          </div>
          <div class="detail-section">
            <span class="detail-label">Depois</span>
            <pre class="detail-pre detail-depois">{{ selectedLog()!.detalhes }}</pre>
          </div>
        } @else {
          <div class="detail-section">
            <span class="detail-label">Detalhes</span>
            <pre class="detail-pre">{{ selectedLog()!.detalhes }}</pre>
          </div>
        }
      </div>
    </div>
  </div>
}
