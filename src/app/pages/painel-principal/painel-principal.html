<div class="painel-page" (click)="onDocumentClick($event)">
  <!-- Header -->
  <div class="page-header">
    <div class="title-section">
      <h1 class="page-title">Painel Principal</h1>
      <p class="page-subtitle">Resumos e estatísticas do sistema</p>
    </div>
  </div>

  <!-- Cards Resumo -->
  <div class="summary-cards">
    <div class="summary-card">
      <div class="summary-icon vendas-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
        </svg>
      </div>
      <div class="summary-info">
        <span class="summary-value">{{ totalVendas() }}</span>
        <span class="summary-label">Vendas Totais</span>
      </div>
    </div>
    <div class="summary-card">
      <div class="summary-icon clientes-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>
        </svg>
      </div>
      <div class="summary-info">
        <span class="summary-value">{{ totalClientes() }}</span>
        <span class="summary-label">Clientes</span>
      </div>
    </div>
    <div class="summary-card">
      <div class="summary-icon entregadores-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="1" y="3" width="15" height="13"/><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"/>
          <circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/>
        </svg>
      </div>
      <div class="summary-info">
        <span class="summary-value">{{ totalEntregadoresAtivos() }}</span>
        <span class="summary-label">Entregadores Ativos</span>
      </div>
    </div>
    <div class="summary-card">
      <div class="summary-icon faturamento-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
        </svg>
      </div>
      <div class="summary-info">
        <span class="summary-value">{{ formatCurrency(faturamentoTotal()) }}</span>
        <span class="summary-label">Faturamento Total</span>
      </div>
    </div>
  </div>

  <!-- ===================== SEÇÃO 1: VENDAS ===================== -->
  <div class="chart-section">
    <div class="section-header-bar">
      <div class="section-title-group">
        <div class="section-icon-badge vendas-badge">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
          </svg>
        </div>
        <div>
          <h2 class="section-title">Vendas por Período</h2>
          <p class="section-desc">Visualize o volume de vendas ao longo do tempo</p>
        </div>
      </div>
      <div class="section-stats">
        <div class="mini-stat">
          <span class="mini-stat-value">{{ totalVendasPeriodo() }}</span>
          <span class="mini-stat-label">vendas</span>
        </div>
        <div class="mini-stat">
          <span class="mini-stat-value">{{ formatCurrency(faturamentoPeriodo()) }}</span>
          <span class="mini-stat-label">faturamento</span>
        </div>
      </div>
    </div>

    <div class="filters-row">
      <div class="filter-group">
        <label>Data Início</label>
        <input type="date" class="filter-input" [value]="vendasDataInicio()" (change)="updateVendasInicio($event)">
      </div>
      <div class="filter-group">
        <label>Data Fim</label>
        <input type="date" class="filter-input" [value]="vendasDataFim()" (change)="updateVendasFim($event)">
      </div>
      <div class="filter-group agrupamento-group">
        <label>Agrupamento</label>
        <div class="agrupamento-toggle">
          <button [class.active]="vendasAgrupamento() === 'dia'" (click)="setAgrupamento('vendas', 'dia')">Dia</button>
          <button [class.active]="vendasAgrupamento() === 'mes'" (click)="setAgrupamento('vendas', 'mes')">Mês</button>
          <button [class.active]="vendasAgrupamento() === 'ano'" (click)="setAgrupamento('vendas', 'ano')">Ano</button>
        </div>
      </div>
    </div>

    <div class="chart-container">
      @if (vendasChartData().length > 0) {
        <div class="chart-wrapper">
          <svg class="chart-svg" viewBox="0 0 800 260" preserveAspectRatio="xMidYMid meet">
            @for (line of getGridLines(vendasMaxValue()); track line) {
              <line [attr.x1]="50" [attr.y1]="getGridY(line, vendasMaxValue(), 200) + 20" [attr.x2]="780" [attr.y2]="getGridY(line, vendasMaxValue(), 200) + 20" class="grid-line"/>
              <text [attr.x]="45" [attr.y]="getGridY(line, vendasMaxValue(), 200) + 25" class="grid-label" text-anchor="end">{{ line }}</text>
            }
            @for (item of vendasChartData(); track item.fullDate; let i = $index) {
              <g class="bar-group">
                <rect
                  [attr.x]="60 + i * ((720) / vendasChartData().length) + ((720) / vendasChartData().length - getBarWidth(vendasChartData().length, 720)) / 2"
                  [attr.y]="getBarY(item.value, vendasMaxValue(), 200) + 20"
                  [attr.width]="getBarWidth(vendasChartData().length, 720)"
                  [attr.height]="getBarHeight(item.value, vendasMaxValue(), 200)"
                  class="chart-bar vendas-bar" rx="3"
                />
                @if (item.value > 0) {
                  <text
                    [attr.x]="60 + i * ((720) / vendasChartData().length) + ((720) / vendasChartData().length) / 2"
                    [attr.y]="getBarY(item.value, vendasMaxValue(), 200) + 14"
                    class="bar-value" text-anchor="middle"
                  >{{ item.value }}</text>
                }
                @if (i % getLabelInterval(vendasChartData().length) === 0) {
                  <text
                    [attr.x]="60 + i * ((720) / vendasChartData().length) + ((720) / vendasChartData().length) / 2"
                    [attr.y]="244" class="bar-label" text-anchor="middle"
                    [attr.transform]="shouldRotateLabels(vendasChartData().length) ? 'rotate(-45,' + (60 + i * ((720) / vendasChartData().length) + ((720) / vendasChartData().length) / 2) + ',244)' : ''"
                  >{{ item.label }}</text>
                }
              </g>
            }
          </svg>
        </div>
      } @else {
        <div class="chart-empty">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
          <p>Nenhuma venda encontrada no período selecionado</p>
        </div>
      }
    </div>
  </div>

  <!-- ===================== SEÇÃO 2: ESTOQUE ===================== -->
  <div class="chart-section">
    <div class="section-header-bar">
      <div class="section-title-group">
        <div class="section-icon-badge estoque-badge">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
            <polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/>
          </svg>
        </div>
        <div>
          <h2 class="section-title">Controle de Estoque</h2>
          <p class="section-desc">Estoque atual e evolução ao longo do tempo</p>
        </div>
      </div>
    </div>

    <!-- Estoque atual: cards -->
    <div class="estoque-cards-grid">
      @for (item of estoqueAtual(); track item.id) {
        <div class="estoque-mini-card" [class]="'estoque-status-' + item.status">
          <div class="estoque-mini-header">
            <span class="estoque-mini-nome">{{ item.nome }}</span>
            <span class="estoque-mini-badge" [class]="'badge-' + item.status">
              @switch (item.status) {
                @case ('critico') { Crítico }
                @case ('baixo') { Baixo }
                @case ('medio') { Médio }
                @default { Normal }
              }
            </span>
          </div>
          <div class="estoque-mini-valor">{{ item.quantidade }}</div>
          <div class="estoque-mini-bar">
            <div class="estoque-mini-bar-fill" [style.width.%]="Math.min((item.quantidade / estoqueMaxValue()) * 100, 100)" [class]="'fill-' + item.status"></div>
          </div>
        </div>
      }
    </div>

    <!-- Gráfico de histórico de estoque -->
    <div class="sub-section">
      <h3 class="sub-section-title">Evolução do Estoque</h3>
      <div class="filters-row">
        <div class="filter-group">
          <label>Data Início</label>
          <input type="date" class="filter-input" [value]="estoqueDataInicio()" (change)="updateEstoqueInicio($event)">
        </div>
        <div class="filter-group">
          <label>Data Fim</label>
          <input type="date" class="filter-input" [value]="estoqueDataFim()" (change)="updateEstoqueFim($event)">
        </div>
        <div class="filter-group agrupamento-group">
          <label>Agrupamento</label>
          <div class="agrupamento-toggle">
            <button [class.active]="estoqueAgrupamento() === 'dia'" (click)="setAgrupamento('estoque', 'dia')">Dia</button>
            <button [class.active]="estoqueAgrupamento() === 'mes'" (click)="setAgrupamento('estoque', 'mes')">Mês</button>
            <button [class.active]="estoqueAgrupamento() === 'ano'" (click)="setAgrupamento('estoque', 'ano')">Ano</button>
          </div>
        </div>
      </div>

      <div class="chart-container">
        @if (estoqueHistorico().length > 0 && estoqueHistorico()[0].pontos.length > 0) {
          <div class="chart-legend">
            @for (serie of estoqueHistorico(); track serie.nome) {
              <div class="legend-item">
                <span class="legend-dot" [style.background]="serie.cor"></span>
                <span class="legend-text">{{ serie.nome }}</span>
              </div>
            }
          </div>
          <div class="chart-wrapper">
            <svg class="chart-svg" viewBox="0 0 800 260" preserveAspectRatio="xMidYMid meet">
              @for (line of getGridLines(estoqueHistoricoMax()); track line) {
                <line [attr.x1]="50" [attr.y1]="getGridY(line, estoqueHistoricoMax(), 200) + 20" [attr.x2]="780" [attr.y2]="getGridY(line, estoqueHistoricoMax(), 200) + 20" class="grid-line"/>
                <text [attr.x]="45" [attr.y]="getGridY(line, estoqueHistoricoMax(), 200) + 25" class="grid-label" text-anchor="end">{{ line }}</text>
              }
              @for (serie of estoqueHistorico(); track serie.nome) {
                <polygon [attr.points]="getAreaPoints(serie.pontos, estoqueHistoricoMax(), 720, 200)" [attr.fill]="serie.cor" fill-opacity="0.08" [attr.transform]="'translate(60, 20)'"/>
                <polyline [attr.points]="getLinePoints(serie.pontos, estoqueHistoricoMax(), 720, 200)" [attr.stroke]="serie.cor" fill="none" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" [attr.transform]="'translate(60, 20)'"/>
                @if (serie.pontos.length <= 60) {
                  @for (ponto of serie.pontos; track $index; let j = $index) {
                    <circle
                      [attr.cx]="60 + (serie.pontos.length > 1 ? j * (720 / (serie.pontos.length - 1)) : 360)"
                      [attr.cy]="getGridY(ponto.valor, estoqueHistoricoMax(), 200) + 20"
                      r="3" [attr.fill]="serie.cor" class="chart-dot"
                    />
                  }
                }
              }
              @if (estoqueHistorico().length > 0) {
                @for (ponto of estoqueHistorico()[0].pontos; track $index; let i = $index) {
                  @if (i % getLabelInterval(estoqueHistorico()[0].pontos.length) === 0) {
                    <text
                      [attr.x]="60 + (estoqueHistorico()[0].pontos.length > 1 ? i * (720 / (estoqueHistorico()[0].pontos.length - 1)) : 360)"
                      [attr.y]="244" class="bar-label" text-anchor="middle"
                    >{{ formatGroupLabel(ponto.data, estoqueAgrupamento()) }}</text>
                  }
                }
              }
            </svg>
          </div>
        } @else {
          <div class="chart-empty">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
            </svg>
            <p>Selecione um período para visualizar a evolução do estoque</p>
          </div>
        }
      </div>
    </div>
  </div>

  <!-- ===================== SEÇÃO 3: QUADRAS ===================== -->
  <div class="chart-section">
    <div class="section-header-bar">
      <div class="section-title-group">
        <div class="section-icon-badge quadras-badge">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/>
          </svg>
        </div>
        <div>
          <h2 class="section-title">Crescimento por Quadra</h2>
          <p class="section-desc">Compare a evolução de clientes em até 5 quadras</p>
        </div>
      </div>
    </div>

    <div class="filters-row">
      <div class="filter-group quadra-selector">
        <label>Quadras (máx. 5)</label>
        <div class="multi-select-container">
          <div class="multi-select-input" (click)="toggleQuadraDropdown()">
            @if (quadrasSelecionadas().length === 0) {
              <span class="placeholder-text">Selecione quadras...</span>
            } @else {
              <div class="selected-tags">
                @for (quadra of quadrasSelecionadas(); track quadra; let i = $index) {
                  <span class="selected-tag" [style.background]="CORES_QUADRAS[i]" [style.border-color]="CORES_QUADRAS[i]">
                    {{ quadra }}
                    <button class="tag-remove" (click)="removeQuadra(quadra); $event.stopPropagation()">×</button>
                  </span>
                }
              </div>
            }
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="select-arrow"><polyline points="6 9 12 15 18 9"/></svg>
          </div>
          @if (showQuadraDropdown()) {
            <div class="multi-select-dropdown">
              <div class="dropdown-search">
                <input type="text" placeholder="Buscar quadra..." [value]="quadraSearchTerm()" (input)="updateQuadraSearch($event)" (click)="$event.stopPropagation()">
              </div>
              <div class="dropdown-list">
                @for (q of quadrasFiltradas(); track q.quadra) {
                  <div class="dropdown-option" [class.selected]="isQuadraSelecionada(q.quadra)" [class.disabled]="!isQuadraSelecionada(q.quadra) && quadrasSelecionadas().length >= 5" (click)="toggleQuadra(q.quadra); $event.stopPropagation()">
                    <div class="option-check" [class.checked]="isQuadraSelecionada(q.quadra)">
                      @if (isQuadraSelecionada(q.quadra)) {
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                      }
                    </div>
                    <span class="option-text">Qd. {{ q.quadra }}</span>
                    <span class="option-count">{{ q.totalClientes }} clientes</span>
                  </div>
                }
              </div>
            </div>
          }
        </div>
      </div>
      <div class="filter-group">
        <label>Data Início</label>
        <input type="date" class="filter-input" [value]="quadrasDataInicio()" (change)="updateQuadrasInicio($event)">
      </div>
      <div class="filter-group">
        <label>Data Fim</label>
        <input type="date" class="filter-input" [value]="quadrasDataFim()" (change)="updateQuadrasFim($event)">
      </div>
      <div class="filter-group agrupamento-group">
        <label>Agrupamento</label>
        <div class="agrupamento-toggle">
          <button [class.active]="quadrasAgrupamento() === 'dia'" (click)="setAgrupamento('quadras', 'dia')">Dia</button>
          <button [class.active]="quadrasAgrupamento() === 'mes'" (click)="setAgrupamento('quadras', 'mes')">Mês</button>
          <button [class.active]="quadrasAgrupamento() === 'ano'" (click)="setAgrupamento('quadras', 'ano')">Ano</button>
        </div>
      </div>
    </div>

    <div class="chart-container">
      @if (quadrasChartData().length > 0 && quadrasChartData()[0].pontos.length > 0) {
        <div class="chart-legend">
          @for (serie of quadrasChartData(); track serie.quadra) {
            <div class="legend-item">
              <span class="legend-dot" [style.background]="serie.cor"></span>
              <span class="legend-text">Qd. {{ serie.quadra }}</span>
            </div>
          }
        </div>
        <div class="chart-wrapper">
          <svg class="chart-svg" viewBox="0 0 800 260" preserveAspectRatio="xMidYMid meet">
            @for (line of getGridLines(quadrasChartMax()); track line) {
              <line [attr.x1]="50" [attr.y1]="getGridY(line, quadrasChartMax(), 200) + 20" [attr.x2]="780" [attr.y2]="getGridY(line, quadrasChartMax(), 200) + 20" class="grid-line"/>
              <text [attr.x]="45" [attr.y]="getGridY(line, quadrasChartMax(), 200) + 25" class="grid-label" text-anchor="end">{{ line }}</text>
            }
            @for (serie of quadrasChartData(); track serie.quadra) {
              <polyline [attr.points]="getLinePoints(serie.pontos, quadrasChartMax(), 720, 200)" [attr.stroke]="serie.cor" fill="none" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" [attr.transform]="'translate(60, 20)'"/>
              @for (ponto of serie.pontos; track $index; let j = $index) {
                @if (serie.pontos.length <= 60) {
                  <circle
                    [attr.cx]="60 + (serie.pontos.length > 1 ? j * (720 / (serie.pontos.length - 1)) : 360)"
                    [attr.cy]="getGridY(ponto.valor, quadrasChartMax(), 200) + 20"
                    r="4" [attr.fill]="serie.cor" stroke="white" stroke-width="2" class="chart-dot"
                  />
                }
              }
            }
            @if (quadrasChartData().length > 0) {
              @for (ponto of quadrasChartData()[0].pontos; track $index; let i = $index) {
                @if (i % getLabelInterval(quadrasChartData()[0].pontos.length) === 0) {
                  <text
                    [attr.x]="60 + (quadrasChartData()[0].pontos.length > 1 ? i * (720 / (quadrasChartData()[0].pontos.length - 1)) : 360)"
                    [attr.y]="244" class="bar-label" text-anchor="middle"
                  >{{ formatGroupLabel(ponto.mes, quadrasAgrupamento()) }}</text>
                }
              }
            }
          </svg>
        </div>
      } @else {
        <div class="chart-empty">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
          <p>Selecione quadras e um período para visualizar o crescimento de clientes</p>
        </div>
      }
    </div>
  </div>

  <!-- ===================== SEÇÃO 4: CLIENTE ===================== -->
  <div class="chart-section">
    <div class="section-header-bar">
      <div class="section-title-group">
        <div class="section-icon-badge cliente-badge">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>
          </svg>
        </div>
        <div>
          <h2 class="section-title">Frequência de Pedidos do Cliente</h2>
          <p class="section-desc">Analise a frequência de compras de um cliente específico</p>
        </div>
      </div>
      @if (clienteSelecionadoId()) {
        <div class="section-stats">
          <div class="mini-stat">
            <span class="mini-stat-value">{{ totalPedidosCliente() }}</span>
            <span class="mini-stat-label">pedidos no período</span>
          </div>
        </div>
      }
    </div>

    <div class="filters-row">
      <div class="filter-group cliente-selector">
        <label>Cliente</label>
        <div class="search-select-container">
          <div class="search-select-input">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-select-icon"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
            <input type="text" placeholder="Buscar cliente por nome ou telefone..." [value]="clienteSearchTerm()" (input)="updateClienteSearch($event)" (focus)="showClienteDropdown.set(true)" (click)="$event.stopPropagation()">
            @if (clienteSelecionadoId()) {
              <button class="clear-btn" (click)="limparCliente(); $event.stopPropagation()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
              </button>
            }
          </div>
          @if (showClienteDropdown() && !clienteSelecionadoId()) {
            <div class="search-select-dropdown">
              @if (clientesFiltrados().length > 0) {
                @for (cliente of clientesFiltrados(); track cliente.id) {
                  <div class="dropdown-option" (click)="selecionarCliente(cliente.id); $event.stopPropagation()">
                    <div class="option-avatar">{{ cliente.nome.charAt(0) }}</div>
                    <div class="option-info">
                      <span class="option-name">{{ cliente.nome }}</span>
                      <span class="option-phone">{{ cliente.telefone }}</span>
                    </div>
                  </div>
                }
              } @else {
                <div class="dropdown-empty">Nenhum cliente encontrado</div>
              }
            </div>
          }
        </div>
      </div>
      <div class="filter-group">
        <label>Data Início</label>
        <input type="date" class="filter-input" [value]="clienteDataInicio()" (change)="updateClienteInicio($event)">
      </div>
      <div class="filter-group">
        <label>Data Fim</label>
        <input type="date" class="filter-input" [value]="clienteDataFim()" (change)="updateClienteFim($event)">
      </div>
      <div class="filter-group agrupamento-group">
        <label>Agrupamento</label>
        <div class="agrupamento-toggle">
          <button [class.active]="clienteAgrupamento() === 'dia'" (click)="setAgrupamento('cliente', 'dia')">Dia</button>
          <button [class.active]="clienteAgrupamento() === 'mes'" (click)="setAgrupamento('cliente', 'mes')">Mês</button>
          <button [class.active]="clienteAgrupamento() === 'ano'" (click)="setAgrupamento('cliente', 'ano')">Ano</button>
        </div>
      </div>
    </div>

    <div class="chart-container">
      @if (clienteChartData().length > 0) {
        <div class="chart-wrapper">
          <svg class="chart-svg" viewBox="0 0 800 260" preserveAspectRatio="xMidYMid meet">
            @for (line of getGridLines(clienteChartMax()); track line) {
              <line [attr.x1]="50" [attr.y1]="getGridY(line, clienteChartMax(), 200) + 20" [attr.x2]="780" [attr.y2]="getGridY(line, clienteChartMax(), 200) + 20" class="grid-line"/>
              <text [attr.x]="45" [attr.y]="getGridY(line, clienteChartMax(), 200) + 25" class="grid-label" text-anchor="end">{{ line }}</text>
            }
            @for (item of clienteChartData(); track item.fullDate; let i = $index) {
              <g class="bar-group">
                <rect
                  [attr.x]="60 + i * ((720) / clienteChartData().length) + ((720) / clienteChartData().length - getBarWidth(clienteChartData().length, 720)) / 2"
                  [attr.y]="getBarY(item.value, clienteChartMax(), 200) + 20"
                  [attr.width]="getBarWidth(clienteChartData().length, 720)"
                  [attr.height]="getBarHeight(item.value, clienteChartMax(), 200)"
                  class="chart-bar cliente-bar" rx="3"
                />
                @if (item.value > 0) {
                  <text [attr.x]="60 + i * ((720) / clienteChartData().length) + ((720) / clienteChartData().length) / 2" [attr.y]="getBarY(item.value, clienteChartMax(), 200) + 14" class="bar-value" text-anchor="middle">{{ item.value }}</text>
                }
                @if (i % getLabelInterval(clienteChartData().length) === 0) {
                  <text [attr.x]="60 + i * ((720) / clienteChartData().length) + ((720) / clienteChartData().length) / 2" [attr.y]="244" class="bar-label" text-anchor="middle"
                    [attr.transform]="shouldRotateLabels(clienteChartData().length) ? 'rotate(-45,' + (60 + i * ((720) / clienteChartData().length) + ((720) / clienteChartData().length) / 2) + ',244)' : ''"
                  >{{ item.label }}</text>
                }
              </g>
            }
          </svg>
        </div>
      } @else {
        <div class="chart-empty">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
          @if (!clienteSelecionadoId()) {
            <p>Selecione um cliente e um período para analisar a frequência de pedidos</p>
          } @else {
            <p>Nenhum pedido encontrado para {{ clienteSelecionado()?.nome }} no período selecionado</p>
          }
        </div>
      }
    </div>
  </div>

  <!-- ===================== SEÇÃO 5: ENTREGADOR ===================== -->
  <div class="chart-section">
    <div class="section-header-bar">
      <div class="section-title-group">
        <div class="section-icon-badge entregador-badge">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="2" y="5" width="20" height="14" rx="2"/><line x1="2" y1="10" x2="22" y2="10"/>
          </svg>
        </div>
        <div>
          <h2 class="section-title">Adiantamentos Salariais</h2>
          <p class="section-desc">Analise os adiantamentos de um entregador ao longo do tempo</p>
        </div>
      </div>
      @if (entregadorSelecionadoId()) {
        <div class="section-stats">
          <div class="mini-stat destaque">
            <span class="mini-stat-value">{{ formatCurrency(totalAdiantamentosPeriodo()) }}</span>
            <span class="mini-stat-label">total no período</span>
          </div>
        </div>
      }
    </div>

    <div class="filters-row">
      <div class="filter-group" style="flex: 1.5;">
        <label>Entregador</label>
        <select class="filter-select" [value]="entregadorSelecionadoId()" (change)="updateEntregador($event)">
          <option value="">Selecione um entregador</option>
          @for (entregador of entregadoresAtivos(); track entregador.id) {
            <option [value]="entregador.id">{{ entregador.identificador }} - {{ entregador.nomeCompleto }}</option>
          }
        </select>
      </div>
      <div class="filter-group">
        <label>Data Início</label>
        <input type="date" class="filter-input" [value]="entregadorDataInicio()" (change)="updateEntregadorInicio($event)">
      </div>
      <div class="filter-group">
        <label>Data Fim</label>
        <input type="date" class="filter-input" [value]="entregadorDataFim()" (change)="updateEntregadorFim($event)">
      </div>
      <div class="filter-group agrupamento-group">
        <label>Agrupamento</label>
        <div class="agrupamento-toggle">
          <button [class.active]="entregadorAgrupamento() === 'dia'" (click)="setAgrupamento('entregador', 'dia')">Dia</button>
          <button [class.active]="entregadorAgrupamento() === 'mes'" (click)="setAgrupamento('entregador', 'mes')">Mês</button>
          <button [class.active]="entregadorAgrupamento() === 'ano'" (click)="setAgrupamento('entregador', 'ano')">Ano</button>
        </div>
      </div>
    </div>

    <div class="chart-container">
      @if (entregadorChartData().length > 0) {
        <div class="chart-wrapper">
          <svg class="chart-svg" viewBox="0 0 800 260" preserveAspectRatio="xMidYMid meet">
            @for (line of getGridLines(entregadorChartMax()); track line) {
              <line [attr.x1]="50" [attr.y1]="getGridY(line, entregadorChartMax(), 200) + 20" [attr.x2]="780" [attr.y2]="getGridY(line, entregadorChartMax(), 200) + 20" class="grid-line"/>
              <text [attr.x]="45" [attr.y]="getGridY(line, entregadorChartMax(), 200) + 25" class="grid-label" text-anchor="end">{{ line }}</text>
            }
            @for (item of entregadorChartData(); track item.fullDate; let i = $index) {
              <g class="bar-group">
                <rect
                  [attr.x]="60 + i * ((720) / entregadorChartData().length) + ((720) / entregadorChartData().length - getBarWidth(entregadorChartData().length, 720)) / 2"
                  [attr.y]="getBarY(item.value, entregadorChartMax(), 200) + 20"
                  [attr.width]="getBarWidth(entregadorChartData().length, 720)"
                  [attr.height]="getBarHeight(item.value, entregadorChartMax(), 200)"
                  class="chart-bar entregador-bar" rx="3"
                />
                @if (item.value > 0) {
                  <text [attr.x]="60 + i * ((720) / entregadorChartData().length) + ((720) / entregadorChartData().length) / 2" [attr.y]="getBarY(item.value, entregadorChartMax(), 200) + 14" class="bar-value" text-anchor="middle">{{ formatCurrency(item.value) }}</text>
                }
                @if (i % getLabelInterval(entregadorChartData().length) === 0) {
                  <text [attr.x]="60 + i * ((720) / entregadorChartData().length) + ((720) / entregadorChartData().length) / 2" [attr.y]="244" class="bar-label" text-anchor="middle"
                    [attr.transform]="shouldRotateLabels(entregadorChartData().length) ? 'rotate(-45,' + (60 + i * ((720) / entregadorChartData().length) + ((720) / entregadorChartData().length) / 2) + ',244)' : ''"
                  >{{ item.label }}</text>
                }
              </g>
            }
          </svg>
        </div>
      } @else {
        <div class="chart-empty">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="5" width="20" height="14" rx="2"/><line x1="2" y1="10" x2="22" y2="10"/></svg>
          @if (!entregadorSelecionadoId()) {
            <p>Selecione um entregador e um período para analisar seus adiantamentos</p>
          } @else {
            <p>Nenhum adiantamento encontrado para {{ entregadorSelecionado()?.identificador }} no período selecionado</p>
          }
        </div>
      }
    </div>
  </div>
</div>